<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.13">
<meta name="author" content="Thomas Nilefalk">
<title>Alan Design Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Alan Design Documentation</h1>
<div class="details">
<span id="author" class="author">Thomas Nilefalk</span><br>
<span id="email" class="email"><a href="mailto:thomas@nilefalk.se">thomas@nilefalk.se</a></span><br>
<span id="revdate">2021-04-14</span>
<br><span id="revremark">Alan 3beta7</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#_overview">2. Overview</a></li>
<li><a href="#_language_design">3. Language Design</a>
<ul class="sectlevel2">
<li><a href="#_articles">3.1. Articles</a>
<ul class="sectlevel3">
<li><a href="#_singular_and_plural">3.1.1. Singular and Plural</a></li>
<li><a href="#_the_any_form">3.1.2. The "Any" form</a></li>
<li><a href="#_pronouns">3.1.3. Pronouns</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_datastructures">4. Datastructures</a>
<ul class="sectlevel2">
<li><a href="#_syntax_mapping_tables">4.1. Syntax Mapping Tables</a></li>
</ul>
</li>
<li><a href="#_code_generation_principles">5. Code Generation Principles</a>
<ul class="sectlevel2">
<li><a href="#_language_constructs">5.1. Language Constructs</a>
<ul class="sectlevel3">
<li><a href="#_for_each">5.1.1. For Each</a></li>
<li><a href="#_aggregates">5.1.2. Aggregates</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_systems_design">6. Systems Design</a>
<ul class="sectlevel2">
<li><a href="#_compiler_design">6.1. Compiler Design</a></li>
<li><a href="#_interpreter_design">6.2. Interpreter Design</a>
<ul class="sectlevel3">
<li><a href="#_interpreter_data_structures">6.2.1. Interpreter Data Structures</a>
<ul class="sectlevel4">
<li><a href="#_the_dictionary">The Dictionary</a></li>
</ul>
</li>
<li><a href="#_acode_instructions">6.2.2. Acode Instructions</a>
<ul class="sectlevel4">
<li><a href="#_frame">FRAME</a></li>
<li><a href="#_getlocal_setlocal">GETLOCAL, SETLOCAL</a></li>
<li><a href="#_loop">LOOP</a></li>
<li><a href="#_loopnext">LOOPNEXT</a></li>
<li><a href="#_loopend">LOOPEND</a></li>
<li><a href="#_endframe">ENDFRAME</a></li>
<li><a href="#_count">COUNT</a></li>
<li><a href="#_max_min_sum">MAX, MIN &amp; SUM</a></li>
<li><a href="#_depend">DEPEND</a></li>
<li><a href="#_depcase">DEPCASE</a></li>
<li><a href="#_depelse">DEPELSE</a></li>
<li><a href="#_enddep">ENDDEP</a></li>
<li><a href="#_dup">DUP</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document is an attempt to describe the design of the Alan IF Language System.
At this point it is very limited and only describes a few aspects.
It was created so that any sudden impulses to describe anything that concerns the design of Alan should have a natural place, hopefully making it more probable that such impulses actually resulted in something.</p>
</div>
<div class="paragraph">
<p>Any additions are welcome.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>2. Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Alan IF Language System consists of a compiler and an interpreter.
The compiler analyzes the input source code (following the Alan language specification) and transforms it to a format that is suitable as input to the interpreter.
That format is referred to as the Acode.</p>
</div>
<div class="paragraph">
<p>The interpreter reads that Acode, constructs some internal structures from it and then starts "executing" it.
In this case "executing" means interpreting specific sections of the Acode, mixing that with asking the player for input and analyzing that to see what other parts of the Acode needs to be interpreted.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_language_design"><a class="anchor" href="#_language_design"></a>3. Language Design</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_articles"><a class="anchor" href="#_articles"></a>3.1. Articles</h3>
<div class="paragraph">
<p>Instances are mentioned and described in a number of situations.
Sometimes it is necessary to refer to it in an indefinite form and sometimes in a definite form.
E.g</p>
</div>
<div class="exampleblock gametranscript">
<div class="content">
<div class="paragraph">
<p>I can&#8217;t open &lt;indefinite form&gt; with a spanner.<br>
You can&#8217;t take &lt;definite form&gt;.</p>
</div>
</div>
</div>
<div class="paragraph">
<p><code>INDEFINITE</code> &amp; <code>DEFINITE</code> forms are required:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-alan" data-lang="alan">The article Isa b
  Definite
    Article "the".
  Indefinite Article "an"
End The article.

The sak Isa x
  Definite
    Form "saken".
  Indefinite
    Article "en"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Not all languages have definite and indefinite articles that work well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-alan" data-lang="alan">Definite "den"
Indefinite "en"
Mentioned "stol"</code></pre>
</div>
</div>
<div class="paragraph">
<p>So we also allow</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-alan" data-lang="alan">Name stol
Definite Form "stolen"
Indefinite Form "en stol"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Mentioned</code> clause should be in indefinite form.
To say a <code>Definite</code> or <code>Indefinite</code> form of the instance:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If that <code>Form</code> is available it will be used, else</p>
</li>
<li>
<p>The <code>Article</code> followed by the <code>Mentioned</code> will be used</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>With corresponding <code>Say</code> statements:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>Say o.</code>      
</td>
<td class="hdlist2">
<p>use <code>Name</code> &#8658; &#8220;stol&#8221;</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>Say The o.</code>  
</td>
<td class="hdlist2">
<p>use <code>Definite</code> &#8658; &#8220;stolen&#8221;</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>Say A o.</code>    
</td>
<td class="hdlist2">
<p>use <code>Indefinite</code> &#8658; &#8220;en stol&#8221;</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(<code>Say Any o.</code> 
</td>
<td class="hdlist2">
<p>use <code>Plural</code> &#8658; &#8220;stolar&#8221;??? Not needed, use <code>"I can&#8217;t see any" Say o. "."</code> for now.)</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Since <code>Mentioned</code> is constructed from the first <code>Name</code> clause the following would work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-alan" data-lang="alan">Every person Isa actor
  Definite Article ""
End Every person.

The mr_a Isa person
  Name mr 'Andersson'
  Name mr andersson
End The mr_a.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Problem is still what to say when:</p>
</div>
<div class="exampleblock gametranscript">
<div class="content">
<div class="paragraph">
<p>&gt; <em>talk to mr andersson</em><br></p>
</div>
<div class="paragraph">
<p>I can&#8217;t see <em>any</em> mr andersson here.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>But a library could:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-alan" data-lang="alan">Syntax talk_to = talk to (p)! Where p Isa person Else ...

Add To Every person
  Verb talk_to
    Check p Is Here
      Else "I can't see" Say The p. "here."
  End Verb talk_to.
End Add To Every person.

Verb talk_to</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_singular_and_plural"><a class="anchor" href="#_singular_and_plural"></a>3.1.1. Singular and Plural</h4>
<div class="paragraph">
<p>Do we really need all the four forms?
Indefinite singular/plural and definite singular/plural?</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_any_form"><a class="anchor" href="#_the_any_form"></a>3.1.2. The "Any" form</h4>
<div class="paragraph">
<p>Possibly there is also a fifth form, as in &#8220;I can&#8217;t see <strong>any</strong> door here.&#8221; But let&#8217;s leave that for later.
Possibly: <code>Say Any x.</code> &amp; <code>Say No x.</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_pronouns"><a class="anchor" href="#_pronouns"></a>3.1.3. Pronouns</h4>
<div class="paragraph">
<p>Some times a pronoun is possibly nice:</p>
</div>
<div class="exampleblock gametranscript">
<div class="content">
<div class="paragraph">
<p>She does not want to talk to you.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>However it is different in output and input.
In input we would like to have &#8220;it&#8221; available for persons too, &#8220;her&#8221;.
Possibly this could be just aliases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-alan" data-lang="alan">The article Isa b
  Definite
    Article "the".
    Pronoun "it".
    Plural "articles"
  Indefinite Form "any article"
The sak Isa x
  Definite
    Form "saken".
    Pronoun "den".
  Indefinite
    Form "sak"</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_datastructures"><a class="anchor" href="#_datastructures"></a>4. Datastructures</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_syntax_mapping_tables"><a class="anchor" href="#_syntax_mapping_tables"></a>4.1. Syntax Mapping Tables</h3>
<div class="paragraph">
<p>Since multiple syntaxes may map to the same verb, a mapping between them is necessary.
This mapping will convert a syntax number into a verb code as well as remapping the parameter numbers into the &#8220;canonical&#8221; order for this verb.</p>
</div>
<div class="paragraph">
<p>The mapping is generated into two structures, the parameter order mapping, and the syntax-verb mapping table.
The parameter mappings are generated separately.
It is simply a table with as many entries as there are parameters in the syntax, followed by an EOF.
As an example a parameter mapping with three parameters in canonical order would be:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{empty}[1] [2] [3] [EOF]</pre>
</div>
</div>
<div class="paragraph">
<p>The syntax-verb mapping is a table of entries, one for each syntax.
The entries have three fields:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">Aint syntaxNumber; +
Aaddr parameterMapping; +
Aint verbCode;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_code_generation_principles"><a class="anchor" href="#_code_generation_principles"></a>5. Code Generation Principles</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_language_constructs"><a class="anchor" href="#_language_constructs"></a>5.1. Language Constructs</h3>
<div class="sect3">
<h4 id="_for_each"><a class="anchor" href="#_for_each"></a>5.1.1. For Each</h4>
<div class="paragraph">
<p>The <code>For Each</code> loop is generated into an initialization step, a filter step and the statements.
A local variable is used since the loop-code might reference the loop value.
Note that the loop value might be different from the loop index, e.g. when looping over a set of integers.
The instructions used are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FRAME</code>&#8201;&#8212;&#8201;start a new stack frame with one local variable</p>
</li>
<li>
<p><code>LOOP</code>&#8201;&#8212;&#8201;the loop start</p>
</li>
<li>
<p><code>LOOPNEXT</code>&#8201;&#8212;&#8201;jump to next loop index</p>
</li>
<li>
<p><code>LOOPEND</code>&#8201;&#8212;&#8201;test for and terminate loop</p>
</li>
<li>
<p><code>ENDFRAME</code>&#8201;&#8212;&#8201;drop stack frame with local variables</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The code layout is as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FRAME 1                               -- create a frame with 1 local
&lt;calculate and push upper limit&gt;
PUSH 1                                -- initial loop index
LOOP
&lt;calculate loop value from index&gt;
SETLOCAL 1                            -- save loop value in local var
GETLOCAL 1
&lt;filter1&gt;                             -- code to evaluate first filter
NOT                                   -- invert it
IF
LOOPNEXT                              -- if the filter did not match, next loop
ENDIF
GETLOCAL 1
&lt;filter2&gt;                             -- code to evaluate 2nd filter
NOT
IF
LOOPNEXT
ENDIF
...                                   -- and so on for each filter
LOOPEND                               -- loop test and termination
ENDFRAME</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_aggregates"><a class="anchor" href="#_aggregates"></a>5.1.2. Aggregates</h4>
<div class="paragraph">
<p>All aggregates are generated into a loop using the same structures as <code>EACH</code>.
The instructions used are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>LOOP</code>&#8201;&#8212;&#8201;start loop</p>
</li>
<li>
<p><code>LOOPNEXT</code>&#8201;&#8212;&#8201;if filter inclusion was not true</p>
</li>
<li>
<p><code>COUNT</code>, <code>MAX</code>, <code>MIN</code> &amp; <code>SUM</code>&#8201;&#8212;&#8201;actual aggregation performed</p>
</li>
<li>
<p><code>LOOPEND</code>&#8201;&#8212;&#8201;repeat or terminate aggregation loop</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The code layout is as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>PUSH &lt;maxint for MIN, 0 for all else&gt; -- initial aggregate value
&lt;calculate and push limit&gt;
PUSH 1                                -- initial loop index
LOOP
&lt;calculate loop value from index&gt;
&lt;filter1&gt;                             -- code to evaluate first filter
NOT
IF
LOOPNEXT
ENDIF
&lt;calculate loop value from index&gt;
&lt;filter2&gt;
NOT
IF
LOOPNEXT
ENDIF
...
&lt;get attribute to aggregate over&gt;     -- for all except COUNT
&lt;aggregate&gt;                           -- COUNT, MIN, MAX or SUM
LOOPEND                               -- loop</pre>
</div>
</div>
<div class="paragraph">
<p>Note that for this to work the aggregate instructions have to look deep in the stack to find the current aggregate value since this is stored at the bottom.
On top is the usual looping data, i.e. the limit, the index and temporarily a loop value.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_systems_design"><a class="anchor" href="#_systems_design"></a>6. Systems Design</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_compiler_design"><a class="anchor" href="#_compiler_design"></a>6.1. Compiler Design</h3>

</div>
<div class="sect2">
<h3 id="_interpreter_design"><a class="anchor" href="#_interpreter_design"></a>6.2. Interpreter Design</h3>
<div class="paragraph">
<p>The Acode is structured in a fashion that closely supports the structure of the Alan Language.
It consists of two types of data, one being data structures of various kinds that the interpreter is inspecting, the other sequences of "instructions" that the interpreter "executes".</p>
</div>
<div class="paragraph">
<p>This chapter describes those data structures and the instructions as well as particular algorithms that are used but the interpreter.</p>
</div>
<div class="sect3">
<h4 id="_interpreter_data_structures"><a class="anchor" href="#_interpreter_data_structures"></a>6.2.1. Interpreter Data Structures</h4>
<div class="sect4">
<h5 id="_the_dictionary"><a class="anchor" href="#_the_dictionary"></a>The Dictionary</h5>
<div class="paragraph">
<p>The dictionary holds all words the player is supposed to be able to input.
A simple sequential lookup converts the string to an index into the dictionary array.</p>
</div>
<div class="paragraph">
<p>Each entry has the following general structure:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="dictionary-entry.png" alt="dictionary entry" width="228" height="145">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_acode_instructions"><a class="anchor" href="#_acode_instructions"></a>6.2.2. Acode Instructions</h4>
<div class="paragraph">
<p>The Acode instructions are designed around the model of a stack machine.
A stack machine primarily uses a stack to manage its state and perform operations.
E.g. an addition of two numbers will be performed by first "executing" two push operations to get the two numbers on the stack.
Then the "add" operation is executed, which requires that there are two numbers already on the stack, which are replaces by the sum.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="stack-machine.png" alt="stack machine" width="610" height="294">
</div>
</div>
<div class="paragraph">
<p>As we can see each operation ("instruction") is either removing something from the stack, and/or pushing something onto it.</p>
</div>
<div class="sect4">
<h5 id="_frame"><a class="anchor" href="#_frame"></a>FRAME</h5>

</div>
<div class="sect4">
<h5 id="_getlocal_setlocal"><a class="anchor" href="#_getlocal_setlocal"></a>GETLOCAL, SETLOCAL</h5>

</div>
<div class="sect4">
<h5 id="_loop"><a class="anchor" href="#_loop"></a>LOOP</h5>
<div class="paragraph">
<p>Use: start a loop</p>
</div>
<div class="paragraph">
<p>Context: on entry the stack contains from the top, starting loop value and the loop limit.</p>
</div>
<div class="paragraph">
<p>Function: Act as a loop start marker.
When executed, check for loop termination, if so, go to end of the corresponding loop.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2">LOOP</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">Before</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">After</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Loop index</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Loop index</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Upper limit of loop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Upper limit of loop</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A loop value has to be calculated from the index since the index might be an index in a <code>SET</code>, such as when looping over the members in a set.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2">CALCULATE LOOP VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">Before</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">After</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Loop value</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Loop index</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Loop index</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Upper limit of loop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Upper limit of loop</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Aggregate value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Aggregate value</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_loopnext"><a class="anchor" href="#_loopnext"></a>LOOPNEXT</h5>
<div class="paragraph">
<p>Use: skip to next loop value</p>
</div>
<div class="paragraph">
<p>Context: none</p>
</div>
<div class="paragraph">
<p>Function: skip forward over instructions (possibly containing <code>LOOP</code>/<code>LOOPEND</code>-pairs) until next instruction to execute is an <code>LOOPEND</code> on the corresponding level.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2">LOOPNEXT</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">Before</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">After</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Loop index</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Loop index</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Upper limit of loop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Upper limit of loop</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_loopend"><a class="anchor" href="#_loopend"></a>LOOPEND</h5>
<div class="paragraph">
<p>Use: test a loop for termination</p>
</div>
<div class="paragraph">
<p>Context: upper limit, and loop index on the top of the stack</p>
</div>
<div class="paragraph">
<p>Function: test the loop index against the upper limit.
If not reached then increment index and back up until next instruction to execute is the first after the matching <code>LOOP</code>, else pop off the index and the limit and continue.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="3">LOOPEND</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">Before</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">Continue</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">Terminate</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Loop index</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Incremented loop index</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Upper limit of loop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Upper limit of loop</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_endframe"><a class="anchor" href="#_endframe"></a>ENDFRAME</h5>

</div>
<div class="sect4">
<h5 id="_count"><a class="anchor" href="#_count"></a>COUNT</h5>
<div class="paragraph">
<p>Use: aggregate (using counting) number of items, usually instances, matching a set of filters</p>
</div>
<div class="paragraph">
<p>Context: at entry the three top values on the stack are the loop value, the loop index, and upper limit as the <code>COUNT</code> follows immediately on an <code>AGRCHECK</code>.
Fourth value from the top is the aggregate value.</p>
</div>
<div class="paragraph">
<p>Function: Increment the fourth topmost value (the aggregate value).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2">COUNT</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">Before</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">After</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Loop index</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Loop index</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Upper limit of loop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Upper limit of loop</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Aggregate value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Updated aggregate value</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_max_min_sum"><a class="anchor" href="#_max_min_sum"></a>MAX, MIN &amp; SUM</h5>
<div class="paragraph">
<p>Works exactly like <code>COUNT</code>, except at entry there is an extra value on the stack (at the top).
This is the attribute value that the aggregation should use.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2">MAX, MIN &amp; SUM</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">Before</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">After</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Attribute value</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Loop index</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Loop index</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Upper limit of loop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Upper limit of loop</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Aggregate value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Updated aggregate value</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_depend"><a class="anchor" href="#_depend"></a>DEPEND</h5>

</div>
<div class="sect4">
<h5 id="_depcase"><a class="anchor" href="#_depcase"></a>DEPCASE</h5>

</div>
<div class="sect4">
<h5 id="_depelse"><a class="anchor" href="#_depelse"></a>DEPELSE</h5>

</div>
<div class="sect4">
<h5 id="_enddep"><a class="anchor" href="#_enddep"></a>ENDDEP</h5>

</div>
<div class="sect4">
<h5 id="_dup"><a class="anchor" href="#_dup"></a>DUP</h5>

</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
</div>
</div>
</body>
</html>